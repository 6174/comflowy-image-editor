"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_react=_interopRequireWildcard(require("react")),_hooks=require("../../../hooks"),_actions=require("../../../actions"),_ColorPickerModal=_interopRequireDefault(require("../ColorPickerModal")),_ColorInput=require("./ColorInput.styled");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(b,c){if(!c&&b&&b.__esModule)return b;if(null===b||"object"!=_typeof(b)&&"function"!=typeof b)return{default:b};var d=_getRequireWildcardCache(c);if(d&&d.has(b))return d.get(b);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in b)if("default"!=a&&Object.prototype.hasOwnProperty.call(b,a)){var g=f?Object.getOwnPropertyDescriptor(b,a):null;g&&(g.get||g.set)?Object.defineProperty(e,a,g):e[a]=b[a]}return e["default"]=b,d&&d.set(b,e),e}var pinnedColorsKey="FIE_pinnedColors",ColorInput=function(a){var b,c=a.onChange,d=a.color,e=a.colorFor,f=(0,_hooks.useStore)(),g=f.selectionsIds,h=void 0===g?[]:g,i=f.config.annotationsCommon,j=void 0===i?{}:i,k=f.dispatch,l=f.latestColors,m=void 0===l?{}:l,n=m[e],o=(0,_react.useState)(),p=(0,_slicedToArray2["default"])(o,2),q=p[0],r=p[1],s=(0,_react.useState)(function(){return n||d||j.fill}),t=(0,_slicedToArray2["default"])(s,2),u=t[0],v=t[1],w=(0,_react.useState)(null!==(b=window)&&void 0!==b&&b.localStorage?JSON.parse(localStorage.getItem(pinnedColorsKey)||"[]"):[]),x=(0,_slicedToArray2["default"])(w,2),y=x[0],z=x[1],A=function(a){var b;if(null!==(b=window)&&void 0!==b&&b.localStorage){var c=window.localStorage.getItem(pinnedColorsKey);if(JSON.stringify(a)!==c){var d=a.slice(-9);window.localStorage.setItem(pinnedColorsKey,JSON.stringify(d)),z(d)}}},B=function(a){r(q?null:a.currentTarget)};return(0,_react.useEffect)(function(){var a=0===h.length&&n||d;v(a),c(a)},[d,h]),_react["default"].createElement(_react["default"].Fragment,null,_react["default"].createElement(_ColorInput.StyledPickerTrigger,{className:"FIE_color-picker-triggerer",onClick:B,$color:u,onChange:c}),_react["default"].createElement(_ColorPickerModal["default"],{hideModalTitle:!0,onChange:function changeColor(a,b,d){v(b),c(b),A(d),n!==b&&k({type:_actions.SET_LATEST_COLOR,payload:{latestColors:(0,_defineProperty2["default"])({},e,b)}})},defaultColor:u,pinnedColors:y,open:!!q,onClose:B}))};ColorInput.defaultProps={color:void 0};var _default=exports["default"]=ColorInput;