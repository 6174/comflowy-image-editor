"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_react=_interopRequireDefault(require("react")),_lockOutline=_interopRequireDefault(require("@scaleflex/icons/lock-outline")),_unlockOutline=_interopRequireDefault(require("@scaleflex/icons/unlock-outline")),_icons=require("@scaleflex/icons"),_actions=require("../../../actions"),_hooks=require("../../../hooks"),_getProperDimensions=_interopRequireDefault(require("../../../utils/getProperDimensions")),_getSizeAfterRotation=_interopRequireDefault(require("../../../utils/getSizeAfterRotation")),_getZoomFitFactor=_interopRequireDefault(require("../../../utils/getZoomFitFactor")),_restrictNumber=_interopRequireDefault(require("../../../utils/restrictNumber")),_constants=require("../../../utils/constants"),_Resize=require("./Resize.styled");function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}var Resize=function(a){var b=a.onChange,c=a.currentSize,d=a.hideResetButton,e=a.alignment,f=a.disableWrap,g=(0,_hooks.useStore)(),h=g.dispatch,i=g.originalImage,j=g.resize,k=g.shownImageDimensions,l=g.adjustments,m=l.crop,n=l.rotation,o=void 0===n?0:n,p=g.theme,q=g.t,r=function(a){var d,e=a.target,f=e.name,g=e.value;if(!(1>parseFloat(g))){var l=Math.min(10*i.width,10*i.height),n=(0,_getSizeAfterRotation["default"])(i.width,i.height,o),p=(0,_defineProperty2["default"])({},f,g?(0,_restrictNumber["default"])(g,0,l):g),q="height"===f,r=q?"width":"height",s=null!==(d=c.ratioUnlocked)&&void 0!==d?d:j.ratioUnlocked;if(!s){var t=n.width/n.height;p[r]=q?Math.round(p[f]*t):Math.round(p[f]/t)}if(p[f]!==j[f]||p[r]!==j[r]){if("function"==typeof b)return void b(p);h({type:_actions.SET_RESIZE,payload:p});var u=m.width&&m.height&&m||k,v=_objectSpread(_objectSpread({},j),p);h({type:_actions.ZOOM_CANVAS,payload:{factor:v.width&&v.height?(0,_getZoomFitFactor["default"])(u,v):_constants.DEFAULT_ZOOM_FACTOR,isAbsoluteZoom:!0}})}}},s="undefined"==typeof j.width&&"undefined"==typeof j.height||i.width===j.width&&i.height===j.height,t=(0,_getProperDimensions["default"])((c.width||c.height)&&c||j,m,k,i,o),u=j.manualChangeDisabled,v="undefined"!=typeof j.width&&!j.width,w="undefined"!=typeof j.height&&!j.height;return _react["default"].createElement(_Resize.StyledResizeWrapper,{className:"FIE_resize-tool-options",alignment:e,disableWrap:f},_react["default"].createElement(_Resize.StyledResizeInput,{className:"FIE_resize-width-option",value:v?"":t.width,name:"width",onChange:u?void 0:r,inputMode:"numeric",title:q("resizeWidthTitle"),label:q("width"),inputProps:{type:"number"},size:"sm",iconEnd:"px",placeholder:"Width",disableWrap:f,disabled:u}),_react["default"].createElement(_Resize.StyledRatioLockIcon,{className:"FIE_resize-ratio-locker",title:q("toggleRatioLockTitle"),onClick:u?void 0:function toggleRatioLock(){return"function"==typeof b?void b({ratioUnlocked:!c.ratioUnlocked}):void h({type:_actions.SET_RESIZE,payload:{ratioUnlocked:!j.ratioUnlocked}})},color:"basic",size:"sm",disabled:u},c.ratioUnlocked||j.ratioUnlocked?_react["default"].createElement(_unlockOutline["default"],{size:16,color:p.palette.success}):_react["default"].createElement(_lockOutline["default"],{size:16,color:p.palette.error})),_react["default"].createElement(_Resize.StyledResizeInput,{className:"FIE_resize-height-option",value:w?"":t.height,name:"height",onChange:u?void 0:r,inputMode:"numeric",title:q("resizeHeightTitle"),label:q("height"),inputProps:{type:"number"},size:"sm",iconEnd:"px",placeholder:"Height",disableWrap:f,disabled:u}),!d&&_react["default"].createElement(_Resize.StyledResetButton,{className:"FIE_resize-reset-button",size:"sm",color:"basic",onClick:s||u?void 0:function resetResize(){h({type:_actions.SET_RESIZE,payload:{width:void 0,height:void 0,ratioUnlocked:!1}});var a=m.width&&m.height&&m||k;h({type:_actions.ZOOM_CANVAS,payload:{factor:(0,_getZoomFitFactor["default"])(a,a)}})},disabled:s||u},_react["default"].createElement(_icons.Reset,null)))};Resize.defaultProps={onChange:void 0,currentSize:{},hideResetButton:!1,alignment:"center",disableWrap:!1};var _default=exports["default"]=Resize;