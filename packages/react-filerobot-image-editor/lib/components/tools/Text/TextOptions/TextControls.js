"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_react=_interopRequireWildcard(require("react")),_menuItem=_interopRequireDefault(require("@scaleflex/ui/core/menu-item")),_fontBold=_interopRequireDefault(require("@scaleflex/icons/font-bold")),_fontItalic=_interopRequireDefault(require("@scaleflex/icons/font-italic")),_constants=require("../../../../utils/constants"),_AnnotationOptions=_interopRequireDefault(require("../../../common/AnnotationOptions")),_AnnotationOptions2=require("../../../common/AnnotationOptions/AnnotationOptions.styled"),_actions=require("../../../../actions"),_restrictNumber=_interopRequireDefault(require("../../../../utils/restrictNumber")),_hooks=require("../../../../hooks"),_TextOptions=require("./TextOptions.styled"),_TextOptions2=require("./TextOptions.constants"),_handleTextChangeArea=require("./handleTextChangeArea");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(b,c){if(!c&&b&&b.__esModule)return b;if(null===b||"object"!=_typeof(b)&&"function"!=typeof b)return{default:b};var d=_getRequireWildcardCache(c);if(d&&d.has(b))return d.get(b);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in b)if("default"!=a&&Object.prototype.hasOwnProperty.call(b,a)){var g=f?Object.getOwnPropertyDescriptor(b,a):null;g&&(g.get||g.set)?Object.defineProperty(e,a,g):e[a]=b[a]}return e["default"]=b,d&&d.set(b,e),e}var TextControls=function(a){var b=a.text,c=a.saveText,d=a.children,e=(0,_hooks.useStore)(),f=e.dispatch,g=e.textIdOfEditableContent,h=e.designLayer,i=e.t,j=e.config,k=j.useCloudimage,l=j[_constants.TOOLS_IDS.TEXT],m=l.fonts,n=void 0===m?[]:m,o=l.onFontChange,p=(0,_react.useCallback)(function(a){var b=a.target,d=b.name,e=b.value,f=b.type;c(function(a){return(0,_defineProperty2["default"])({id:a.id},d,"number"===f?(0,_restrictNumber["default"])(e,1,500):e)})},[c]),q=(0,_react.useCallback)(function(a){if(p({target:{name:"fontFamily",value:a}}),b.fontFamily!==a&&"function"==typeof o){var c=h.draw.bind(h);o(a,c)}},[p,b,h]),r=(0,_react.useCallback)(function(a){var c,d=(null===(c=b.fontStyle)||void 0===c?void 0:c.replace("normal","").split(" "))||[];0<Object.keys(d).length&&d.includes(a)?d=d.filter(function(b){return b!==a}):d.push(a),p({target:{name:"fontStyle",value:d.join(" ").trim()||"normal"}})},[b]),s=(0,_react.useCallback)(function(){f({type:_actions.ENABLE_TEXT_CONTENT_EDIT,payload:{textIdOfEditableContent:null}})},[]),t=(0,_react.useCallback)(function(a){p({target:{name:"text",value:a}}),s()},[]);return(0,_react.useEffect)(function(){var a;if(g&&b.id===g){var c=h.getStage(),d=(0,_slicedToArray2["default"])(c.findOne("#".concat(_constants.TRANSFORMERS_LAYER_ID)).children,1);a=d[0],(0,_handleTextChangeArea.activateTextChange)(g,c,a,t,s)}return function(){a&&g&&(0,_handleTextChangeArea.deactivateTextChange)()}},[g]),_react["default"].createElement(_AnnotationOptions["default"],{className:"FIE_text-tool-options",annotation:b,updateAnnotation:c,morePoppableOptionsPrepended:k?[]:_TextOptions2.TEXT_POPPABLE_OPTIONS,moreOptionsPopupComponentsObj:k?{}:_TextOptions2.textOptionsPopupComponents,t:i},Array.isArray(n)&&1<n.length&&_react["default"].createElement(_TextOptions.StyledFontFamilySelect,{className:"FIE_text-font-family-option",onChange:q,value:b.fontFamily,placeholder:i("fontFamily"),size:"sm"},n.map(function(){var a,b,c,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return _react["default"].createElement(_menuItem["default"],{className:"FIE_text-font-family-item",key:null!==(a=d.value)&&void 0!==a?a:d,value:null!==(b=d.value)&&void 0!==b?b:d},null!==(c=d.label)&&void 0!==c?c:d)})),_react["default"].createElement(_TextOptions.StyledFontSizeInput,{className:"FIE_text-size-option",value:b.fontSize||"",name:"fontSize",onChange:p,inputMode:"numeric",type:"number",size:"sm",placeholder:i("size")}),_react["default"].createElement(_TextOptions.StyledToolsWrapper,null,!k&&_react["default"].createElement(_react["default"].Fragment,null,_react["default"].createElement(_AnnotationOptions2.StyledIconWrapper,{className:"FIE_text-bold-option",active:(b.fontStyle||"").includes("bold"),onClick:function onClick(){return r("bold")},watermarkTool:!0},_react["default"].createElement(_fontBold["default"],{size:20})),_react["default"].createElement(_AnnotationOptions2.StyledIconWrapper,{className:"FIE_text-italic-option",active:(b.fontStyle||"").includes("italic"),onClick:function onClick(){return r("italic")},watermarkTool:!0},_react["default"].createElement(_fontItalic["default"],{size:20}))),d))};TextControls.defaultProps={children:null};var _default=exports["default"]=TextControls;