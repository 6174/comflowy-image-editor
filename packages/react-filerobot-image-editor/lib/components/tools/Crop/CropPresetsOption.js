"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_react=_interopRequireWildcard(require("react")),_actions=require("../../../actions"),_hooks=require("../../../hooks"),_ToolsBar=require("../../ToolsBar/ToolsBar.styled"),_constants=require("../../../utils/constants"),_toPrecisedFloat=_interopRequireDefault(require("../../../utils/toPrecisedFloat")),_getZoomFitFactor=_interopRequireDefault(require("../../../utils/getZoomFitFactor")),_icons=require("@scaleflex/icons"),_core=require("@scaleflex/ui/core"),_Crop=require("./Crop.constants"),_CropPresetGroupsFolder=_interopRequireDefault(require("./CropPresetGroupsFolder")),_CropPresetItem=_interopRequireDefault(require("./CropPresetItem")),_Crop2=require("./Crop.styled");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(b,c){if(!c&&b&&b.__esModule)return b;if(null===b||"object"!=_typeof(b)&&"function"!=typeof b)return{default:b};var d=_getRequireWildcardCache(c);if(d&&d.has(b))return d.get(b);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in b)if("default"!=a&&Object.prototype.hasOwnProperty.call(b,a)){var g=f?Object.getOwnPropertyDescriptor(b,a):null;g&&(g.get||g.set)?Object.defineProperty(e,a,g):e[a]=b[a]}return e["default"]=b,d&&d.set(b,e),e}var CropPresetsOption=function(a){var b=a.anchorEl,c=a.onClose,d=(0,_hooks.useStore)(),f=d.dispatch,g=d.t,e=d.adjustments,h=void 0===e?{}:e,i=h.crop,j=void 0===i?{}:i,k=j.ratio,l=j.ratioTitleKey,m=j.ratioFolderKey,n=d.shownImageDimensions,o=d.config,p=d.theme,q=k||_constants.ORIGINAL_CROP,r=o[_constants.TOOLS_IDS.CROP],s=(0,_hooks.usePhoneScreen)(),t=(0,_react.useMemo)(function(){var a=r.presetsItems,b=void 0===a?[]:a,c=r.presetsFolders,d=void 0===c?[]:c,e=r.lockCropAreaAt,f=e?_Crop.DEFAULT_CROP_PRESETS.filter(function(a){var b;return!(null!==(b=a.hide)&&void 0!==b&&b.call(a,{lockCropAreaAt:e}))}):_Crop.DEFAULT_CROP_PRESETS;return[].concat((0,_toConsumableArray2["default"])(d),(0,_toConsumableArray2["default"])(f),(0,_toConsumableArray2["default"])(b))},[r]),u=function(a,b,d){a.stopPropagation();var e={ratio:b,ratioTitleKey:d.ratioTitleKey,ratioGroupKey:d.ratioGroupKey,ratioFolderKey:d.ratioFolderKey,noEffect:d.noEffect};f({type:_actions.SET_CROP,payload:e}),r.autoResize&&(f({type:_actions.SET_RESIZE,payload:{width:d.width,height:d.height,manualChangeDisabled:d.disableManualResize}}),f({type:_actions.ZOOM_CANVAS,payload:{factor:d.width>n.width||d.height>n.height?(0,_getZoomFitFactor["default"])(n,d):_constants.DEFAULT_ZOOM_FACTOR}})),c()};return _react["default"].createElement(_react["default"].Fragment,null,_react["default"].createElement(_Crop2.StyledToolsBarItemButtonWrapper,null,_react["default"].createElement(_ToolsBar.StyledToolsBarItemButtonLabel,{className:"FIE_crop-tool-label FIE_selected-crop-preset-label",isPhoneScreen:s},g(l||"cropTool")),_react["default"].createElement(_Crop2.StyledOpenMenuButton,{className:"FIE_crop-presets-opener-button",color:"link-secondary",size:"lg"},b?_react["default"].createElement(_icons.MoveUpOutline,{size:10}):_react["default"].createElement(_icons.MoveDownOutline,{size:10}))),_react["default"].createElement(_core.Menu,{className:"FIE_crop-presets-menu",anchorEl:b,enableOverlay:!0,onClose:c,open:!!b,position:"top",popperOptions:{modifiers:[{name:"offset",options:{offset:[0,4]}}]},maxHeight:"100%"},_react["default"].createElement(_Crop2.StyledMenu,null,t.map(function renderPreset(a){var b=a.titleKey,c=a.descriptionKey,d=a.ratio,e=a.width,f=a.height,h=a.groups,i=a.icon,j=a.disableManualResize,k=a.noEffect;return h?_react["default"].createElement(_CropPresetGroupsFolder["default"],{key:b,titleKey:b,groups:h,Icon:i,theme:p,onItemSelect:u,t:g,disableManualResize:j}):_react["default"].createElement(_CropPresetItem["default"],{key:d,ratio:null!==d&&void 0!==d?d:(0,_toPrecisedFloat["default"])(e/f),titleKey:b,t:g,description:g(c),Icon:i,isActive:q===(null!==d&&void 0!==d?d:(0,_toPrecisedFloat["default"])(e/f))&&!m,theme:p,width:e,height:f,onClick:u,disableManualResize:j,noEffect:k})}))))};CropPresetsOption.defaultProps={anchorEl:null};var _default=exports["default"]=CropPresetsOption;