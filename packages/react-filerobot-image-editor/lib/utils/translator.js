"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateTranslations=exports.translate=exports.getBackendTranslations=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_defaultTranslations=_interopRequireDefault(require("../context/defaultTranslations")),_constants=require("./constants");function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){(0,_defineProperty2["default"])(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}var backendTranslations={},activatedTranslations=_objectSpread({},_defaultTranslations["default"]),hardcodedErrorMsg="Error while loading translations from backend.",updateTranslations=exports.updateTranslations=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"en";return Object.assign(activatedTranslations,backendTranslations[null===b||void 0===b?void 0:b.toLowerCase()]||{},a)},sendMissingTranslationsToBackend=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[];return new Promise(function(b,c){var d=new XMLHttpRequest;d.responseType="json",d.onload=function(){if(200<=d.status&&300>d.status)b(d.response);else{var a;console.warn("Error in sending translation key to backend ".concat(null===(a=d.response)||void 0===a?void 0:a.hint,", ").concat(d.status)),c()}},d.onerror=function(){var a;console.warn("Error in sending translation key to backend ".concat(null===(a=d.response)||void 0===a?void 0:a.hint,", ").concat(d.status)),c()};var e={grid_uuid:_constants.TRANSLATIONS_GRID_UUID,translations_requests:a};d.open("POST","https://neo.wordplex.io/api/import/request-translations?grid_uuid=".concat(_constants.TRANSLATIONS_GRID_UUID)),d.send(JSON.stringify(e))})},getBackendTranslations=exports.getBackendTranslations=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"en",b=1<arguments.length?arguments[1]:void 0;return new Promise(function(c,d){var e=a.toLowerCase(),f=new XMLHttpRequest;f.responseType="json",f.onload=function(){if(200<=f.status&&300>f.status){(f.response||[]).forEach(function(a){backendTranslations[e]=_objectSpread(_objectSpread({},backendTranslations[e]),{},(0,_defineProperty2["default"])({},a.translation_key,a.translations[e]))});var a=[];Object.keys(_defaultTranslations["default"]).forEach(function(b){var c;b&&!(null!==(c=backendTranslations[e])&&void 0!==c&&c[b])&&a.push({key:b,lang:e,default:_defaultTranslations["default"][b]})}),0<a.length&&sendMissingTranslationsToBackend(a),updateTranslations(b,e),c(activatedTranslations)}else{var g,h,i;console.error("Status code: ".concat(f.status)),console.error((null===(g=f.response)||void 0===g?void 0:g.msg)||(null===(h=f.response)||void 0===h?void 0:h.msg)||(null===(i=f.response)||void 0===i?void 0:i.details)||hardcodedErrorMsg),d()}},f.onerror=function(){console.error("Status code ".concat(f.status,", error: ").concat(hardcodedErrorMsg)),d()},f.open("GET","https://i18n.ultrafast.io/api/export?grid=".concat(_constants.TRANSLATIONS_GRID_UUID)),f.send()})},translate=exports.translate=function(a){return activatedTranslations[a]||a||""};